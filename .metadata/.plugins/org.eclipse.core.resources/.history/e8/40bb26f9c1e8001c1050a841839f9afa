package com.example.CompanyStockPrice.Service;

import java.time.LocalDate;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.example.CompanyStockPrice.Entity.Company;
import com.example.CompanyStockPrice.Entity.Stock;
import com.example.CompanyStockPrice.Repository.CompanyRepository;
import com.example.CompanyStockPrice.Repository.StockRepository;

@Service
public class CompanyStockService {
	
	@Autowired
	private CompanyRepository companyRepository;
	
	@Autowired
	private StockRepository stockRepository;
	
	public List<Company> listAllCompany()
	{
		return companyRepository.findAll();
	}

	public List<Stock> listAllStock()
	{
		return stockRepository.findAll();
	}
	
	public List<Stock> findAllStockByCompanyCode(int companyCode)
	{
		return stockRepository.findByCompanyCode(companyCode);
	}
	
	public String deleteCompanyAndStock(int companyCode)
	{
		Company company = new Company();
		company.setCompanyCode(companyCode);
		companyRepository.deleteById(company.getCompanyCode());
		
		Stock stock = new Stock();
		stock.setCompanyCode(companyCode);
		stockRepository.deleteAllStockForCompany(stock.getCompanyCode());
		
		return "Company Deleted successfully!!";
	}
	
	public List<Stock> getMinMaxAvgBetweenDate(int companyCode ,LocalDate fromDate ,LocalDate endDate)
	{	  
		Stock stock = new Stock();
		Stock stock1 = new Stock();
		stock.setCompanyCode(companyCode);
		stock.setStockDate(fromDate);
		stock1.setStockDate(endDate);
		return stockRepository.findByCompanyCodeAndBetweenDates(stock.getCompanyCode(), stock.getStockDate(), stock1.getStockDate());
	}
}
